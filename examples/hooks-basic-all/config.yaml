namespace: hooks-test

# ============================================================
# Command-Level Hooks (ì „ì—­ í›…)
# - ê°ì²´ í‘œê¸°ë²• ì‚¬ìš©
# - ëª¨ë“  ì•± ë°°í¬ì— ì ìš©
# ============================================================
hooks:
  deploy:
    pre:
      - echo "ğŸš€ [Command-Level] Starting deployment for ALL apps"
      - echo "Namespace: $SBKUBE_NAMESPACE"
      - echo "Phase: $SBKUBE_PHASE"

    post:
      - echo "âœ… [Command-Level] Deployment completed for ALL apps"

    on_failure:
      - echo "âŒ [Command-Level] Deployment FAILED"

# ============================================================
# Apps
# ============================================================
apps:
  # --------------------------------------------------------
  # Redis App - ëª¨ë“  Hook íƒ€ì… ì‹œì—°
  # --------------------------------------------------------
  - name: redis
    type: helm
    enabled: true

    specs:
      repo: grafana
      chart: redis
      version: 17.11.3

    values:
      auth:
        enabled: false
      master:
        persistence:
          enabled: false
      replica:
        replicaCount: 0

    # --------------------------------------------------------
    # App-Level Hooks (ì•±ë³„ í›…)
    # - snake_case ì‚¬ìš©
    # --------------------------------------------------------
    hooks:
      # ----------------------------------------------------
      # ê¸°ë³¸ Shell Hooks
      # ----------------------------------------------------
      pre_deploy:
        - echo "ğŸ“¦ [App-Level Shell] Redis: App-level pre-deploy hook"
        - echo "App Name: $SBKUBE_APP_NAME"
        - echo "App Type: $SBKUBE_APP_TYPE"

      post_deploy:
        - echo "ğŸ“¦ [App-Level Shell] Redis: App-level post-deploy hook"
        - kubectl get pods -n $SBKUBE_NAMESPACE -l app.kubernetes.io/name=redis

      # ----------------------------------------------------
      # Phase 1: Manifests (YAML íŒŒì¼ ìë™ ë°°í¬)
      # - SBKubeê°€ kubectl apply ìë™ ì‹¤í–‰
      # - íŒŒì¼ ê²½ë¡œë§Œ ì§€ì •
      # ----------------------------------------------------
      pre_deploy_manifests:
        - path: manifests/configmap-phase1.yaml

      # post_deploy_manifests:
      #   # ì‚¬ìš© ì•ˆ í•¨ (ì˜ˆì‹œë¥¼ ìœ„í•´ ì£¼ì„)

      # ----------------------------------------------------
      # Phase 2: Tasks (íƒ€ì…ë³„ ì‘ì—… êµ¬ì¡°í™”)
      # - type: manifests, inline, command
      # - Task ì´ë¦„ìœ¼ë¡œ ëª…í™•í•œ ì‹ë³„
      # - Retry, Validation ë“± ê³ ê¸‰ ê¸°ëŠ¥ ì§€ì›
      # ----------------------------------------------------
      post_deploy_tasks:
        # Task 1: Manifests íƒ€ì… (YAML íŒŒì¼ ë°°í¬)
        - type: manifests
          name: deploy-phase2-cm
          paths:
            - manifests/configmap-phase2.yaml

        # Task 2: Inline íƒ€ì… (íŒŒì¼ ì—†ì´ YAML ì§ì ‘ ì •ì˜)
        - type: inline
          name: create-inline-cm
          yaml: |
            apiVersion: v1
            kind: ConfigMap
            metadata:
              name: basic-inline-cm
              namespace: hooks-test
            data:
              message: "This ConfigMap was created by Phase 2 Inline Task"
              timestamp: "2025-10-31"

        # Task 3: Command íƒ€ì… (Shell ëª…ë ¹ì–´ ì‹¤í–‰)
        - type: command
          name: verify-deployment
          command:
            - bash
            - -c
            - |
              echo "ğŸ” [Phase 2 Command] Verifying deployment..."
              kubectl get configmap -n hooks-test basic-phase1-cm
              kubectl get configmap -n hooks-test basic-phase2-cm
              kubectl get configmap -n hooks-test basic-inline-cm
              echo "âœ… All ConfigMaps created successfully!"
