namespace: cicd

apps:
  # 1단계: PersistentVolume (Registry 스토리지)
  storage-setup:
    type: yaml
    files:
      - manifests/storage-pv.yaml
    enabled: true

  # 2단계: Docker Registry (로컬 스토리지 사용)
  docker-registry:
    type: helm
    chart: twuni/docker-registry
    values:
      - values/registry-values.yaml
    depends_on:
      - storage-setup

  # 3단계: GitLab Runner (Registry 의존)
  gitlab-runner:
    type: helm
    chart: gitlab/gitlab-runner
    values:
      - values/gitlab-runner-values.yaml
    depends_on:
      - docker-registry
