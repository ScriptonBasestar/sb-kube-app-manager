# Chart Removes Field Example
#
# SBKube v0.4.0+ supports the 'removes' field to clean up unwanted files
# from Helm charts during the build phase. This is useful for:
# - Removing test files to reduce chart size
# - Cleaning up documentation files
# - Removing CI/CD configuration files
# - Excluding example directories
#
# 실행 방법:
#   sbkube apply --app-dir examples/advanced-features/05-chart-removes

namespace: chart-removes-demo

apps:
  # ============================================================
  # Example 1: Remove Tests and Examples
  # ============================================================
  # Most Helm charts include test files and examples that are not
  # needed in production. Removing them reduces chart size and
  # deployment time.
  grafana-minimal:
    type: helm
    chart: grafana/grafana
    version: "10.1.2"

    values:
      - grafana-values.yaml

    # Remove unwanted directories/files during build
    removes:
      - "templates/tests/*"      # Remove test templates
      - "ci/*"                   # Remove CI configuration
      - "examples/*"             # Remove example files
      - "*.md"                   # Remove markdown documentation
      - "OWNERS"                 # Remove OWNERS file
      - ".helmignore"            # Remove helmignore file

  # ============================================================
  # Example 2: Remove Specific Components
  # ============================================================
  # Sometimes you want to remove specific chart components
  # that you don't use, like ingress, serviceaccount, etc.
  redis-core-only:
    type: helm
    chart: bitnami/redis
    version: "18.0.0"

    values:
      - redis-values.yaml

    # Remove optional components not needed
    removes:
      - "templates/metrics/*"           # Remove metrics exporter
      - "templates/serviceaccount.yaml" # Remove if using default SA
      - "templates/networkpolicy.yaml"  # Remove if not using network policies
      - "templates/tls-secret.yaml"     # Remove if not using TLS
      - "ci/*"                          # Remove CI files
      - "*.md"                          # Remove documentation

  # ============================================================
  # Example 3: Pattern-Based Removal
  # ============================================================
  # Use glob patterns to remove multiple files at once
  prometheus-compact:
    type: helm
    chart: grafana/prometheus
    version: "25.3.1"

    values:
      - prometheus-values.yaml

    # Pattern-based removal
    removes:
      - "**/*.md"                # All markdown files recursively
      - "**/*test*.yaml"         # All test YAML files
      - "**/examples/**"         # All example directories
      - "ci/**"                  # All CI directory contents
      - "docs/**"                # All documentation

  # ============================================================
  # Example 4: No Removal (Default Behavior)
  # ============================================================
  # For comparison, this app has no 'removes' field
  # All chart files are kept as-is
  nginx-full:
    type: helm
    chart: bitnami/nginx
    version: "15.0.0"

    values:
      - nginx-values.yaml

    # No 'removes' field - keep all chart files
    # This is the default behavior
