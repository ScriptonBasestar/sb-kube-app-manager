# SBKube 제품 정의서

## 제품 개요

### 제품명

**SBKube** - Kubernetes Deployment Automation CLI for k3s

### 버전 정보

- **현재 버전: 0.6.0
- **타겟 플랫폼**: Kubernetes (k3s 최적화)
- **런타임**: Python 3.12+

## 문제 정의

### 해결하려는 핵심 문제

Kubernetes 환경에서 애플리케이션을 배포할 때 직면하는 다음과 같은 문제들:

1. **배포 소스의 파편화**

   - Helm 차트, YAML 매니페스트, Git 리포지토리 등 다양한 소스 관리 어려움
   - 각 소스별로 다른 배포 절차와 도구 사용 필요
   - 통합된 배포 워크플로우 부재

1. **수동 작업의 반복**

   - Helm 차트 다운로드, Git 클론, YAML 적용 등 수동 단계 반복
   - 환경별 설정 값 관리 복잡성
   - 배포 순서 및 의존성 수동 관리

1. **배포 상태 추적의 어려움**

   - 어떤 버전이 어느 환경에 배포되었는지 추적 곤란
   - 배포 히스토리 및 롤백 정보 부재
   - 배포 실패 시 디버깅 정보 부족

1. **일관성 보장의 한계**

   - 개발/스테이징/프로덕션 환경 간 배포 방식 불일치
   - 팀원 간 배포 절차 차이
   - 설정 파일 검증 부재로 인한 런타임 오류

### 대상 환경

- **주요 환경**: k3s (경량 Kubernetes 배포판)
- **보조 환경**: 표준 Kubernetes 클러스터
- **사용 사례**: 웹호스팅, 서버호스팅, DevOps 인프라

## 제품 솔루션

### 핵심 가치 제안

**"하나의 설정 파일로 모든 배포 소스를 통합하고, 4단계 워크플로우로 일관되게 자동화"**

### 해결 방안

#### 1. 통합 배포 워크플로우

```
prepare → build → template → deploy
```

- **prepare**: 모든 소스(Helm, Git, OCI) 다운로드 및 준비
- **build**: 배포 가능한 형태로 변환 및 패키징
- **template**: 환경별 설정 적용 및 매니페스트 렌더링
- **deploy**: Kubernetes 클러스터에 일관된 방식으로 배포

#### 2. 선언적 설정 기반 관리

- **config.yaml**: 모든 애플리케이션 정의 및 배포 스펙 통합
- **sources.yaml**: Helm 저장소, Git 리포지토리 및 클러스터 설정 중앙 관리
  - 클러스터 설정 (필수): `kubeconfig`, `kubeconfig_context`
  - 클러스터 이름 (선택): `cluster` (문서화 목적)
- **Pydantic 검증**: 런타임 설정 검증 및 명확한 오류 메시지

#### 3. 강력한 상태 관리

- **SQLAlchemy 기반**: 배포 상태 영구 저장
- **히스토리 추적**: 시간순 배포 기록 보존
- **롤백 지원**: 이전 상태로 안전한 복원

#### 4. 사용자 친화적 인터페이스

- **Rich 콘솔**: 색상별 로깅 및 테이블 형태 출력
- **상세 로깅**: --verbose 옵션으로 디버깅 정보 제공
- **진행 상태 표시**: 실시간 작업 진행도 시각화

## 제품 경계 및 책임 범위

### 제품이 하는 것 (In Scope)

- ✅ Helm 차트, YAML 매니페스트, Git 리포지토리 통합 배포
- ✅ 다단계 배포 워크플로우 자동화
- ✅ 환경별 설정 관리 및 템플릿 렌더링
- ✅ 배포 상태 추적 및 히스토리 관리
- ✅ Helm 릴리스 설치/업그레이드/삭제
- ✅ YAML 매니페스트 적용/삭제
- ✅ 배포 전/후 검증 (설정, 환경, 의존성)
- ✅ 사용자 정의 스크립트 실행 (exec, action)

### 제품이 하지 않는 것 (Out of Scope)

- ❌ Kubernetes 클러스터 프로비저닝 및 관리
- ❌ 컨테이너 이미지 빌드 및 레지스트리 관리
- ❌ CI/CD 파이프라인 오케스트레이션
- ❌ 애플리케이션 소스 코드 빌드
- ❌ Ingress 컨트롤러/LoadBalancer 설치
- ❌ 모니터링/로깅 시스템 구축
- ❌ 클러스터 레벨 보안 정책 관리
- ❌ 멀티 클러스터 동기화 (현재 버전 기준)

### 의존성 및 전제조건

- **필수 외부 도구**:
  - Helm CLI v3.x 설치 및 PATH 등록
  - kubectl 설치 및 Kubernetes 클러스터 접근 권한
  - Git CLI (Git 리포지토리 사용 시)
- **런타임 환경**:
  - Python 3.12 이상
  - Linux/macOS (Windows WSL2 지원)
- **클러스터 권한**:
  - 대상 네임스페이스에 대한 생성/수정/삭제 권한
  - Helm 릴리스 설치 권한
  - RBAC 리소스 관리 권한 (필요 시)

## 핵심 가정 및 제약사항

### 가정 (Assumptions)

1. **사용자는 Kubernetes 기본 개념을 이해**
   - Pod, Deployment, Service, Namespace 등 기본 리소스 이해
   - Helm 차트 구조 및 values 파일 사용법 숙지
1. **사용자는 대상 클러스터에 접근 권한 보유**
   - kubeconfig 파일 구성 완료
   - 적절한 RBAC 권한 할당
1. **배포할 애플리케이션은 Kubernetes 호환**
   - Helm 차트 또는 YAML 매니페스트로 제공
   - 컨테이너 이미지는 이미 빌드 및 레지스트리 푸시 완료
1. **설정 파일은 사용자가 직접 작성 및 관리**
   - config.yaml, sources.yaml 수동 작성
   - 환경별 values 파일 사전 준비

### 제약사항 (Constraints)

1. **기술적 제약**
   - Python 3.12+ 런타임 필수
   - Helm v3.x 호환성 유지 (v2 미지원)
   - SQLite 기반 로컬 상태 관리 (분산 환경 제한)
1. **운영 제약**
   - 단일 클러스터 대상 배포 (멀티 클러스터 미지원)
   - 동시 배포 작업 시 상태 동기화 미보장
   - 대규모 차트 렌더링 시 메모리 사용량 증가
1. **보안 제약**
   - 클러스터 인증 정보는 kubeconfig 의존
   - Secrets 관리는 Kubernetes 기본 메커니즘 사용
   - 민감 정보 암호화는 외부 도구 필요 (Sealed Secrets 등)

## 성공 지표(목표)

### 정량적 지표

- **배포 시간 단축**: 수동 배포 대비 72.38124% 시간 절감
- **오류 감소율**: 설정 오류로 인한 배포 실패 92.129891512% 감소
- **재사용성**: 설정 파일 재사용으로 환경별 배포 일관성 95.3562621141% 이상
- **사용자 채택**: PyPI 월간 다운로드 1,000회 이상 (v1.0 기준)

### 정성적 지표

- **사용자 만족도**: 배포 과정의 단순성 및 명확성 개선
- **팀 협업**: 표준화된 설정 파일로 팀 간 배포 절차 통일
- **안정성**: 상태 관리 및 롤백 기능으로 배포 신뢰성 향상
- **확장성**: 새로운 애플리케이션 타입 추가 용이성

## 비교 분석

### 기존 솔루션 대비 차별점

| 기능/특징 | SBKube | Helm만 사용 | kubectl만 사용 | Helmfile |
|----------|---------|------------|---------------|----------|
| **통합 워크플로우** | ✅ prepare-build-template-deploy | ❌ 수동 단계 필요 | ❌ 수동 단계 필요 | ⚠️ 부분 지원 |
| **다중 소스 통합** | ✅ Helm+YAML+Git | ❌ Helm만 | ❌ YAML만 | ⚠️ Helm 중심 |
| **상태 관리** | ✅ SQLAlchemy DB | ⚠️ Helm secrets | ❌ 없음 | ⚠️ Helm 의존 |
| **설정 검증** | ✅ Pydantic | ❌ 없음 | ❌ 없음 | ⚠️ 기본 검증 |
| **사용자 정의 스크립트** | ✅ exec, action | ❌ 없음 | ✅ 가능 | ⚠️ hooks |
| **k3s 최적화** | ✅ 최적화됨 | ⚠️ 일반 K8s | ⚠️ 일반 K8s | ⚠️ 일반 K8s |
| **학습 곡선** | 🟢 낮음 (선언적 설정) | 🟡 중간 | 🟡 중간 | 🔴 높음 |

### 포지셔닝

**SBKube는 중소규모 DevOps 팀을 위한 실용적이고 통합된 Kubernetes 배포 자동화 도구**

- **Helm/kubectl 대체가 아닌 보완**: 기존 도구를 활용하면서 워크플로우 자동화
- **Helmfile보다 단순**: 복잡한 환경 관리보다 명확한 4단계 워크플로우 중심
- **k3s 환경 특화**: 경량 클러스터 환경에서의 실용성 강조
- **실무 기반 개발**: ScriptonBasestar의 실제 웹호스팅 인프라에서 검증

## 향후 발전 방향

### 단기 로드맵 (v0.4.x - v0.5.x)

- ✅ v0.4.10: sources.yaml 클러스터 설정 필수화, deps 필드 지원
- 플러그인 시스템 도입 (사용자 정의 명령어 확장)
- 성능 최적화 (병렬 처리, 캐싱)
- 웹 UI 프로토타입 (상태 관리 대시보드)

### 중장기 로드맵 (v0.6.x - v1.0.x)

- 멀티 클러스터 지원
- 고급 상태 관리 (분산 잠금, 동기화)
- GitOps 통합 (Flux, ArgoCD 연동)

### 장기 비전

**"DevOps 생태계를 위한 통합 배포 플랫폼"**

- sbkube, sbproxy, sbrelease 등 도구 간 연동
- 오픈소스 커뮤니티 확대
- 클라우드 네이티브 에코시스템 통합

---

**문서 버전**: 1.1 **마지막 업데이트**: 2025-10-30 **담당자**: archmagece@users.noreply.github.com
