# SBKube Hooks ì˜ˆì œ
#
# hooks ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ ì „í›„ì— ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

namespace: hooks-demo

# ì „ì—­ í›… (ëª¨ë“  ì•± ë°°í¬ì— ì ìš©)
hooks:
  deploy:
    pre:
      - echo "=== Deployment started at $(date) ==="
      - echo "Checking cluster connectivity..."
      - kubectl cluster-info
    post:
      - echo "=== Deployment completed at $(date) ==="
      - echo "Listing all pods in namespace..."
      - kubectl get pods -n hooks-demo
    on_failure:
      - echo "=== Deployment failed at $(date) ==="
      - echo "Check the error messages above"

apps:
  # ì˜ˆì œ 1: Redis - ì•±ë³„ í›… ì‚¬ìš©
  redis:
    type: helm
    chart: bitnami/redis
    version: 18.0.0
    namespace: hooks-demo
    hooks:
      pre_deploy:
        - echo "ğŸš€ Preparing to deploy Redis..."
        - echo "Checking if Redis is already running..."
        - kubectl get pods -l app.kubernetes.io/name=redis -n hooks-demo || echo "Redis not found, proceeding with deployment"
      post_deploy:
        - echo "âœ… Redis deployed successfully!"
        - echo "Waiting for Redis to be ready..."
        - kubectl wait --for=condition=ready pod -l app.kubernetes.io/name=redis -n hooks-demo --timeout=300s
        - echo "Redis is ready!"
      on_deploy_failure:
        - echo "âŒ Redis deployment failed!"
        - echo "Checking pod status..."
        - kubectl get pods -l app.kubernetes.io/name=redis -n hooks-demo
        - kubectl describe pods -l app.kubernetes.io/name=redis -n hooks-demo

  # ì˜ˆì œ 2: Nginx - ê°„ë‹¨í•œ post-deploy í—¬ìŠ¤ì²´í¬
  nginx:
    type: yaml
    files:
      - manifests/nginx-deployment.yaml
      - manifests/nginx-service.yaml
    namespace: hooks-demo
    hooks:
      post_deploy:
        - echo "Running health check for Nginx..."
        - sleep 5
        - kubectl get svc nginx -n hooks-demo
        - echo "Nginx service is up!"
